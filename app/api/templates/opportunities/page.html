<main class="page">
  <div class="page-header fade-in">
    <div class="page-title-section">
      <h1 class="page-title">Open Opportunities</h1>
      <p class="page-subtitle">Live feed from municipal procurement portals. Updated automatically every few hours.</p>
    </div>
  </div>
  {{STATS_HTML}}
  {{FILTERS_HTML}}
  {{TABLE_HTML}}
</main>

{{MODAL_HTML}}
<link rel="stylesheet" href="/static/css/dashboard.css"> 
<link rel="stylesheet" href="/static/css/opportunities.css"> 

<script src="/static/js/highlight.js"></script>
<script src="/static/js/rfq_modal.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  // Animate stat counts if data-count is present
  document.querySelectorAll('.stat-value[data-count]').forEach((el) => {
    const target = Number(el.dataset.count || 0);
    const start = performance.now();
    const duration = 1200;
    const step = (ts) => {
      const progress = Math.min(1, (ts - start) / duration);
      const eased = 1 - Math.pow(1 - progress, 3);
      el.textContent = Math.round(target * eased);
      if (progress < 1) requestAnimationFrame(step);
    };
    if (target > 0) requestAnimationFrame(step);
  });

  // Stagger table row entry
  document.querySelectorAll('.opportunities-table tbody tr').forEach((row, idx) => {
    row.style.animationDelay = `${idx * 50}ms`;
  });

  // Refresh tracking count from server to ensure accuracy
  const tracking = document.getElementById('tracking-count');
  if (tracking) {
    fetch('/tracker/count', { credentials: 'include' })
      .then((res) => res.ok ? res.json() : null)
      .then((data) => {
        if (!data) return;
        const next = Number(data.count || 0);
        tracking.dataset.count = String(next);
        tracking.textContent = Number.isInteger(next) ? String(next) : next.toFixed(1);
      })
      .catch(() => {});
  }
});
</script>
